{%- assign back = page.dir | split: '/' -%}
{%- if back.size == 5 -%}
  {%- assign section = item.dir | split: '/' | last -%}
{%- elsif back.size == 6 -%}
  {%- assign size = back | size | minus:2 -%}
  {%- assign section = back | last -%}
  {%- assign object = item.dir | split: '/' | last -%}
{%- elsif back.size == 7 -%}
  {%- assign size = back | size | minus:3 -%}
  {%- assign section = back | last -%}
  {%- assign object = item.dir | split: '/' | last -%}
{%- else -%}
  {%- assign size = back | size | minus:1 -%}
{%- endif -%}
{%- assign dir = back | slice: 0, size | join: "/" | append: '/' -%}
{%- assign region = dir | split: '/' | last -%}
{%- assign ps = site.pages | sort: 'dir' | where_exp: 'i', 'i.url contains dir and i.url == dir' -%}
{%- for lo in ps limit:1 -%}{%- if lo.breadcrumb -%}{%- assign location = lo.breadcrumb -%}{%- else -%}{%- assign location = lo.navtitle -%}{%- endif -%}{%- endfor -%}
{%- capture aid -%}6{%- increment counter -%}{%- endcapture -%}
{%- if forloop.first -%}
<div class="row mt-4 mx-n2 row-cols-1 row-cols-lg-3 row-cols-md-2 row-cols-sm-2">
{%- endif -%}
  <div class="col px-2 mb-3">
    <div class="card h-100">
      <img src="https://unsplash.it/400/200/?image={%- increment counter -%}" class="card-img-top" alt="Image {{ item.title }}">
      <div class="card-body">
        <h5 class="card-title">
          <a href="{{ item.url }}">
            {%- if item.title -%}{{ item.title }}{%- else -%}{{ item.navtitle }}{%- endif -%}
          </a>
        </h5>
        <div class="card-text mb-1">
          <nav>
            <ul class="nav nav-tabs" id="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-tab" role="tablist">
              <li class="nav-item d-none" role="presentation">
                <a class="nav-link active" id="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-offers-tab" data-toggle="tab" href="#{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-offers" role="tab" aria-controls="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-offers" aria-selected="false">
                  {{ site.data.lang-uk.offers }}
                </a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{object}}{%- endif -%}-actions-tab" data-toggle="tab" href="#{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-actions" role="tab" aria-controls="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-actions" aria-selected="false">
                  {{ site.data.lang-uk.actions }}
                </a>
              </li>
            </ul>
          </nav>
          befor IF:<br>
          region: {{ region }}<br>
          section: {{ section }}<br>
          object: {{ object }}<br>
          item.breadcrumb: {{item.breadcrumb}}<br>
          location: {{location}}<br>
          <div class="tab-content" id="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-content">
            <div class="tab-pane pt-3 fade active show" id="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-offers" role="tabpanel" aria-labelledby="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-offers-tab">
              {% if back.size >= 6 %}
                <br>
                befor IF:<br>
                region: {{ region }}<br>
                section: {{ section }}<br>
                object: {{ object }}<br>
                item.breadcrumb: {{item.breadcrumb}}<br>
                location: {{location}}<br>
                <br>
                {%- include variables/complex.html title=item.title slice=2 -%}
                {%- assign records = site.data[section] | where_exp: "i", "i.location contains location and i.object contains item.breadcrumb" -%}
              {% else %}
                {%- assign records = site.data[section] | where_exp: 'i', 'i.location contains location' -%}
              {% endif %}
              {%- if records.size > 0 -%}
                {%- assign offers = records | sort: 'date' | reverse -%}
                {%- for offer in offers limit: 1 -%}
                  {%- include card.html offer=offer aid=aid -%}
                {%- endfor -%}
                <div class="card border-0 text-center">
                  <a href="{{ item.url }}" class="btn btn-primary">Інші <strong>{{ offers | size }}</strong> пропозиції нерухомості</a>
                </div>
              {%- else -%}
                <div class="alert alert-primary" role="alert">
                  <p>Поки що тут жодної нерухомості, але ви можете виправити це додавши свої пропозиції, а ми залюбки опублікуємо їх тут.</p>
                  <hr>
                  <p class="mb-0">Про те, як це зробити ви можете дізнатись перейшовши за цим посиланням '<a href="#" class="alert-link">додати свою нерухомість</a>'.</p>
                </div>
              {%- endif -%}
            </div>
            <div class="tab-pane pt-3 fade" id="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-actions" role="tabpanel" aria-labelledby="{{ region }}-{{ section }}{%- if back.size >= 6 -%}-{{ object }}{%- endif -%}-actions-tab">
              <p>Акційні пропозиції від...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{%- if forloop.last -%}
</div>
{%- endif -%}
